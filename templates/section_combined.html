<section class="grid">
  {% if not grid %}<p class="empty">Aucun √©l√©ment.</p>{% endif %}
  {% for it in grid %}
    {% if it.kind == 'folder' %}
      <article class="card folder">
        <a class="thumb" href="{{ it.url }}" title="Ouvrir le dossier">
          <div class="foldericon">üìÅ</div>
          <div class="badge">DOSSIER</div>
          <div class="badge right">{{ it.count }} √©l√©ments</div>
        </a>
        <h3 title="{{ it.name }}">{{ it.name }}</h3>
        <p class="meta"><span>Derni√®re modif.</span> ‚Ä¢ <span>{{ it.latest | datetime }}</span></p>
      </article>
{% else %}
  <article class="card {{ 'played' if it.played else 'unplayed' }}" data-vid="{{ it.id }}" data-duration="{{ it.duration or '' }}">
    <a class="thumb" href="/watch/{{ it.id }}?back={{ request.full_path | urlencode }}">
      <img loading="lazy" src="/thumb/{{ it.id }}.jpg" alt="preview"/>
      <div class="badge">{{ it.ext.upper() }}</div>
      {% if it.played %}<div class="status">Lue</div>{% else %}<div class="status un">Non lue</div>{% endif %}
    </a>

    <!-- √âtoile favori compacte -->
    <button class="fav-btn {{ 'active' if it.fav else '' }}" aria-label="Favori" title="Favori" data-id="{{ it.id }}">‚òÖ</button>

    <h3 title="{{ it.name }}">{{ it.name }}</h3>
    <p class="meta">
      <span>{{ it.size | filesize }}</span>
      {% if it.res %} ‚Ä¢ <span>{{ it.res }}</span>{% endif %}
      {% if it.p %} ‚Ä¢ <span>{{ it.p }}</span>{% endif %}
    </p>

    <p class="tagsline">
      {% set t_show = (it.ctags or it.tags or [])[:5] %}
      {% if t_show %}
        {% for t in t_show %}
          <a class="pill" href="{{ url_for('browse', tags=(','.join((request.args.get('tags','') or '').split(',') + [t])), mix=mix, sort=sort, read=readf, per=per) }}" data-tag="{{ t }}">{{ t }}</a>
        {% endfor %}
      {% else %}
        <span class="muted">(pas de tag)</span>
      {% endif %}
    </p>

    <!-- Ancien bouton texte : on peut le supprimer si voulu
    <div class="actions">
      <button class="favbtn-grid {{ 'on' if it.fav else '' }}" data-vid="{{ it.id }}">{{ '‚òÖ' if it.fav else '‚òÜ' }}</button>
    </div>
    -->
  </article>
{% endif %}

  {% endfor %}
</section>
